<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Bem Vindo, faça seu login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="main.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'rosa-bebe': '#fdf2f8',
                        'rosa-claro': '#fce7f3',
                        'rosa-medio': '#f9a8d4',
                        'rosa-vibrante': '#ec4899',
                        'lavanda': '#f3e8ff'
                    }
                }
            }
        }
    </script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

        const firebaseConfig = {
        apiKey: "AIzaSyDoL4R2GmKy7gqnWXKei8V5lflH4plEMkM",
        authDomain: "agenda-f58b7.firebaseapp.com",
        projectId: "agenda-f58b7",
        storageBucket: "agenda-f58b7.firebasestorage.app",
        messagingSenderId: "88974735864",
        appId: "1:88974735864:web:0e9a029173d6409f61be0d",
        measurementId: "G-0DSR8JY53N"
        };
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => { 
            if (user) window.location.href = "agenda.html"; 
        });

        window.addEventListener('DOMContentLoaded', () => {
        // Lottie bg
        if (window.lottie) {
            window.lottie.loadAnimation({
            container: document.getElementById('bg-lottie'),
            renderer: 'svg',
            loop: true,
            autoplay: true,
            path: 'assets/animations/bg-animation.json'
            });
        }

        // Validação de senha em tempo real
        const registerPassword = document.getElementById('register-password');
        const confirmPassword = document.getElementById('register-password-confirm');
        const lengthCheck = document.getElementById('pwd-length');
        const upperCheck = document.getElementById('pwd-upper');
        const lowerCheck = document.getElementById('pwd-lower');
        const numberCheck = document.getElementById('pwd-number');
        const symbolCheck = document.getElementById('pwd-symbol');
        const matchCheck = document.getElementById('pwd-match');

        // Função para validar a força da senha
        function validatePassword() {
          const pwd = registerPassword.value;
          
          // Verificações
          const hasLength = pwd.length >= 8;
          const hasUpper = /[A-Z]/.test(pwd);
          const hasLower = /[a-z]/.test(pwd);
          const hasNumber = /[0-9]/.test(pwd);
          const hasSymbol = /[^A-Za-z0-9]/.test(pwd);
          
          // Atualiza os indicadores
          lengthCheck.className = hasLength ? 'text-green-500' : 'text-red-500';
          upperCheck.className = hasUpper ? 'text-green-500' : 'text-red-500';
          lowerCheck.className = hasLower ? 'text-green-500' : 'text-red-500';
          numberCheck.className = hasNumber ? 'text-green-500' : 'text-red-500';
          symbolCheck.className = hasSymbol ? 'text-green-500' : 'text-red-500';
          
          return hasLength && hasUpper && hasLower && hasNumber && hasSymbol;
        }

        // Verifica se as senhas coincidem
        function checkPasswordMatch() {
          if (confirmPassword.value && registerPassword.value) {
            if (confirmPassword.value === registerPassword.value) {
              matchCheck.className = 'text-xs text-green-500 mt-1';
              matchCheck.textContent = 'Senhas iguais ✓';
              return true;
            } else {
              matchCheck.className = 'text-xs text-red-500 mt-1';
              matchCheck.textContent = 'As senhas devem ser iguais';
              return false;
            }
          }
          return false;
        }

        registerPassword.addEventListener('input', validatePassword);
        confirmPassword.addEventListener('input', checkPasswordMatch);

        // Modificar o evento de submit para validar a senha
        registerForm?.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (registerError) registerError.textContent = '';
          const email = document.getElementById('register-email').value.trim();
          const password = registerPassword.value;
          
          // Validação completa
          const isValidPassword = validatePassword();
          const passwordsMatch = checkPasswordMatch();
          
          if (!isValidPassword) {
            registerError.textContent = 'A senha não atende aos requisitos mínimos';
            return;
          }
          
          if (!passwordsMatch) {
            registerError.textContent = 'As senhas não coincidem';
            return;
          }
          
          try {
            await createUserWithEmailAndPassword(auth, email, password);
            // Volta ao login com crossfade
            registerForm.classList.add('is-hidden');
            loginForm.classList.remove('is-hidden');
            loginError.textContent = 'Conta criada! Faça login.';
          } catch (err) {
            registerError.textContent = 'Erro ao criar conta. ' + (err?.message || '');
          }
        });

        // Elements
        const wrapper = document.querySelector('.auth-wrapper');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const showRegisterBtn = document.getElementById('show-register-btn');
        const backLoginBtn = document.getElementById('back-login-btn');
        const loginError = document.getElementById('login-error');
        const registerError = document.getElementById('register-error');

        // Define min-height para não “pular”
        const computeMinHeight = () => {
            const wasHidden = registerForm.classList.contains('is-hidden');
            if (wasHidden) registerForm.classList.remove('is-hidden');
            const maxH = Math.max(loginForm.scrollHeight, registerForm.scrollHeight);
            if (wasHidden) registerForm.classList.add('is-hidden');
            document.querySelector('.auth-stack').style.minHeight = maxH + 'px';
        };
        computeMinHeight();
        window.addEventListener('resize', computeMinHeight);

        // Crossfade
        showRegisterBtn?.addEventListener('click', () => {
            if (loginError) loginError.textContent = '';
            loginForm.classList.add('is-hidden');
            registerForm.classList.remove('is-hidden');
        });
        backLoginBtn?.addEventListener('click', () => {
            if (registerError) registerError.textContent = '';
            registerForm.classList.add('is-hidden');
            loginForm.classList.remove('is-hidden');
        });

        // Submit handlers
        loginForm?.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (loginError) loginError.textContent = '';
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            try {
            await signInWithEmailAndPassword(auth, email, password);
            window.location.href = "index.html";
            } catch {
            loginError.textContent = 'E-mail ou senha inválidos!';
            }
        });

        registerForm?.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (registerError) registerError.textContent = '';
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            try {
            await createUserWithEmailAndPassword(auth, email, password);
            // Volta ao login com crossfade
            registerForm.classList.add('is-hidden');
            loginForm.classList.remove('is-hidden');
            loginError.textContent = 'Conta criada! Faça login.';
            } catch (err) {
            registerError.textContent = 'Erro ao criar conta. ' + (err?.message || '');
            }
        });
        });
    </script>
</head>
<body class="bg-azul-login flex items-center justify-center min-h-screen">
  <div id="bg-lottie" style="position:fixed; inset:0; z-index:0; pointer-events:none;"></div>

  <div class="login-glass p-8 auth-wrapper" style="z-index:1;">
    <div class="auth-stack">
      <!-- Login -->
      <form id="login-form" class="form-panel space-y-4">
        <h3 class="text-lg font-bold text-azul-login mb-2 text-center">Entrar na Agenda</h3>
        <div>
          <label class="block text-sm font-medium mb-1">E-mail:</label>
          <input type="email" id="login-email" class="w-full px-3 py-2 border border-azul-login rounded-lg" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Senha:</label>
          <input type="password" id="login-password" class="w-full px-3 py-2 border border-azul-login rounded-lg" required>
        </div>
        <button type="submit" class="w-full bg-azul-login-btn py-2 rounded-lg hover:opacity-90 transition-colors font-medium">Entrar</button>
        <button id="show-register-btn" type="button" class="mt-2 w-full bg-gray-200 text-azul-login py-2 rounded-lg hover:bg-gray-300 font-medium">Criar uma conta</button>
        <div id="login-error" class="mt-2 text-red-500 text-sm font-semibold"></div>
      </form>

      <!-- Cadastro -->
      <form id="register-form" class="form-panel is-hidden space-y-4">
        <h3 class="text-lg font-bold text-azul-login mb-2 text-center">Bem Vindo ao LifeSync</h3>
        <div>
          <label class="block text-sm font-medium mb-1">E-mail:</label>
          <input type="email" id="register-email" class="w-full px-3 py-2 border border-azul-login rounded-lg" required>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Senha:</label>
          <input type="password" id="register-password" class="w-full px-3 py-2 border border-azul-login rounded-lg" required>
          <div class="text-xs text-gray-500 mt-1">
            A senha deve ter no mínimo 8 caracteres e incluir:
            <ul class="list-disc ml-4 mt-1">
              <li id="pwd-length" class="text-red-500">8 caracteres</li>
              <li id="pwd-upper" class="text-red-500">Letra maiúscula</li>
              <li id="pwd-lower" class="text-red-500">Letra minúscula</li>
              <li id="pwd-number" class="text-red-500">Número</li>
              <li id="pwd-symbol" class="text-red-500">Símbolo</li>
            </ul>
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1">Confirmar Senha:</label>
          <input type="password" id="register-password-confirm" class="w-full px-3 py-2 border border-azul-login rounded-lg" required>
          <div id="pwd-match" class="text-xs text-red-500 mt-1">As senhas devem ser iguais</div>
        </div>
        <button type="submit" class="w-full bg-azul-login-btn text-white py-2 rounded-lg hover:bg-rosa-medio transition-colors font-medium">Criar Conta</button>
        <button type="button" id="back-login-btn" class="mt-2 w-full bg-gray-200 text-azul-login py-2 rounded-lg hover:bg-gray-300 font-medium">Voltar ao login</button>
        <div id="register-error" class="mt-2 text-red-500 text-sm font-semibold"></div>
      </form>
    </div>
  </div>
</body>
</html>